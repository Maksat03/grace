{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Grace Agency Admin</title>

	<script src="{% static 'js/shabyt.js/packages/highlight.min.js' %}"></script>
	<script src="{% static 'js/shabyt.js/packages/axios.min.js' %}"></script>
	<script src="{% static 'js/shabyt.js/packages/quill.js' %}"></script>
	<script src="{% static 'js/shabyt.js/packages/image-resize.min.js' %}"></script>
	<script src="{% static 'js/shabyt.js/packages/sweetalert.min.js' %}"></script>
	<script src="{% static 'js/shabyt.js/packages/vue.global.prod.js' %}"></script>
	<script src="{% static 'js/shabyt.js/packages/vue-cookies.js' %}"></script>
	<script src="{% static 'js/shabyt.js/packages/quill.imageCompressor.min.js' %}"></script>
	<script src="{% static 'js/shabyt.js/packages/moment.js' %}"></script>


	<link rel="stylesheet" href="{% static 'css/admin/base.css' %}">
	<link rel="stylesheet" href="{% static 'css/admin/quill.snow.css' %}">
</head>
<body>
	<div class="sidebar" id="sidebar">
		<div class="block">
			<a href="/"><h3>Grace Agency</h3></a>
		</div>

		<hr>

		<div class="block">
			<h4>Admin</h4>
		</div>

		<hr>

		<div class="block">
			<p @click="open_section('products')" id="products_section_btn">Товары</p>
			<p @click="open_section('services')" id="services_section_btn">Услуги</p>
			<p @click="open_section('requests')" id="requests_section_btn">Заявки <span id="new_requests_count" class="new_requests_not_found"></span></p>
		</div>

		<hr>

		<div class="block">
			<p @click="open_section('settings')" id="settings_section_btn">Настройки</p>
			<a href="/logout/" style="color: red"><b>Выйти</b></a>
		</div>
	</div>

	<div class="section" id="template_section" style="display: none">
		<div class="sidebar">
			<p class="hide_sidebar" onclick="close_sidebar()">></p>
			<div class="block sidebar_top" style="padding-top: 25px;">
				<h2 style="font-size: 24px; margin: 0;">Category</h2>
				<button class="plus_btn"><span>+</span></button>
			</div>

			<ul class="block categories_list">
				<li @dragstart="drag_start" @dragover="drag_over" @drop="drop" class="category_item dropzone" draggable="true">
					<a><img src="{% static 'imgs/edit.png' %}"></a>
<!--					<input type="radio" name="category" id="category_name">-->
<!--					<label for="category_name">category_name</label>-->
				</li>
			</ul>
		</div>

		<div class="section_content">
			<div class="section_top">
				<div class="section_title">
					<h2>Section</h2>
					<button class="plus_btn"><span>+</span></button>
				</div>

				<form class="section_search">
					<input type="text" name="search">
					<span>Search</span>
				</form>
			</div>

			<div class="table">
				<div class="row column_names">
					<div class="column">
						<div class="column-img">Photo</div>
					</div>
					<div class="column">Name</div>
					<div class="column">Name</div>
					<div class="column">Name</div>
					<div class="column">CheckBox</div>
					<div class="column">Name</div>
					<div class="column">Name</div>
					<div class="column">Phone Number</div>
					<div class="column">Created at</div>
					<div class="column">
						<div class="column-img">Photo</div>
					</div>
					<div class="column">Name</div>
					<div class="column">Name</div>
					<div class="column">Name</div>
					<div class="column">CheckBox</div>
					<div class="column">Name</div>
					<div class="column">Name</div>
					<div class="column">Phone Number</div>
					<div class="column">Created at</div>
					<div class="column">
						<div class="column-img">Photo</div>
					</div>
					<div class="column">Name</div>
					<div class="column">Name</div>
					<div class="column">Name</div>
					<div class="column">CheckBox</div>
					<div class="column">Name</div>
					<div class="column">Name</div>
					<div class="column">Phone Number</div>
				</div>

				<div class="rows">
					<div class="row">
						<div class="column">
							<div class="column-img">Photo</div>
						</div>
						<div class="column">Name</div>
						<div class="column">Name</div>
						<div class="column">Name</div>
						<div class="column">
<!--							<input type="checkbox">-->
						</div>
						<div class="column">Name</div>
						<div class="column">Name</div>
						<div class="column">Phone Number</div>
						<div class="column">Created at</div>
					</div>
					<div class="row">
						<div class="column">
							<div class="column-img">Photo</div>
						</div>
						<div class="column">Name</div>
						<div class="column">Name</div>
						<div class="column">Name</div>
						<div class="column">
<!--							<input type="checkbox">-->
						</div>
						<div class="column">Name</div>
						<div class="column">Name</div>
						<div class="column">Phone Number</div>
						<div class="column">Created at</div>
					</div>
					<div class="row">
						<div class="column">
							<div class="column-img">Photo</div>
						</div>
						<div class="column">Name</div>
						<div class="column">Name</div>
						<div class="column">Name</div>
						<div class="column">
<!--							<input type="checkbox">-->
						</div>
						<div class="column">Name</div>
						<div class="column">Name</div>
						<div class="column">Phone Number</div>
						<div class="column">Created at</div>
					</div>
					<div class="row">
						<div class="column">
							<div class="column-img">Photo</div>
						</div>
						<div class="column">Name</div>
						<div class="column">Name</div>
						<div class="column">Name</div>
						<div class="column">
<!--							<input type="checkbox">-->
						</div>
						<div class="column">Name</div>
						<div class="column">Name</div>
						<div class="column">Phone Number</div>
						<div class="column">Created at</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="section" id="services" style="display: none">
		<div class="section_content">
			<div class="section_top">
				<div class="section_title">
					<h2>Услуги</h2>
					<button @click="open_service_form()" class="plus_btn"><span>+</span></button>
				</div>
			</div>

			<div class="table">
				<div class="row column_names">
					<div class="column">
						<div class="column-img">Фото</div>
					</div>
					<div class="column">Названия</div>
					<div class="column">Категория</div>
					<div class="column"></div>
				</div>

				<div class="rows">
					<div class="row" v-for="service in services">
						<div class="column">
							<div class="column-img" :style="'background-image: url(' + service.poster + ')'"></div>
						</div>
						<div class="column">${ service.name }</div>
						<div class="column">${ service.parent_service_name }</div>
						<div class="column"><button @click="open_service_form(service)" class="accept_btn">Изменить</button></div>
					</div>
				</div>
			</div>
		</div>

		<div id="service_form_window">
			<form id="service_form" @submit.prevent="service_form_submit()">
				{% csrf_token %}
				<div class="add_product_block">
					<h2 style="margin-top: 0" v-if="service_form.id">Редактировать услугу</h2>
					<h2 style="margin-top: 0" v-else>Добавить услугу</h2>

					<div class="add_product block_css">
						<b>Родительская услуга:</b>

						<select v-model="service_form['parent_service_id']" required name="parent_service_id">
							<option value="null" selected>Нет</option>
							<option v-for="parent_service in categories" :value="parent_service.id">${ parent_service.name }</option>
						</select>
					</div>
					<div class="add_product block_css">
						<b>Название:</b>
						<input type="text" placeholder="Название" required v-model="service_form['name']" name="service_name">
					</div>
					<div class="add_product product_imgs_inputs">
						<b>Обложка: </b>
						<div style="margin-bottom: 5px" v-if="!service_poster_is_uploaded_to_input()">
							<a class="uploaded_file_name" style="margin-right: 1px; width: fit-content; cursor: initial">Текущий:</a>
							<a :href="service_form.poster" v-cloak class="uploaded_file_name" v-if="service_form.poster">${ service_form.poster.replace('/media/posters/', '') }</a>
						</div>
						<input id="service_poster_file_input" type="file" @change="handle_service_poster_upload($event)" :required="service_form.poster == ''" class="service_form_image_input" name="service_poster">
					</div>
					<div class="add_product block_css">
						<b>О услуге</b>
						<div id="service_form_description_editor"></div>
					</div>

					<div class="add_product product_imgs_inputs">
						<b>Фотографии услуги:</b>

						<div v-for="(image, key) in service_form['images']" :key="key" class="car_input"> <!-- draggable="true" -->
							<span style="margin-right: 6px">Текущий: </span>
							<a v-if="!image_is_uploaded_to_input(image) && image.image != ''" :href="image.image" v-cloak>${ image.image.replace('/media/service_images/', '') }</a>
							<span class="uploaded_file_name" v-else>${ image.image }</span>
							<input name="image" type="file" :id="'service_image_upload_input_' + key" @change="handle_file_upload(image, $event)" :required="image.image == ''" class="service_form_image_input" style="display: none;">
							<button type="button" class="open_file_select_window_btn" style="margin-right: 15px" @click="open_file_select_window(key)">Загрузить фото...</button>
							<button @click="delete_image(image)" type="button"><img src="{% static 'imgs/trash.png' %}"></button>
						</div>

						<span style="color: #008EDE; cursor: pointer" @click="add_image()">Добавить фото</span>
					</div>

					<div class="add_product btns">
						<div v-if="service_form.id">
							<button class="add_btn" type="submit">Изменить</button>
							<button class="delete_btn" type="button" @click="delete_service()">Удалить</button>
						</div>
						<div v-else>
							<button class="add_btn" type="submit">Добавить</button>
						</div>
					</div>
				</div>

				<div class="close">
					<a onclick='document.getElementById("service_form_window").style.display = "none"'><img src="{% static 'imgs/shabyt.imgs/cross.png' %}" alt=""></a>
				</div>
			</form>
		</div>
	</div>

	<div class="section" id="products" style="display: none">
		<div class="section_content">
			<div class="section_top">
				<div class="section_title">
					<h2>Товары</h2>
					<button @click="open_product_form()" class="plus_btn"><span>+</span></button>
				</div>

				<form class="section_search" @submit.prevent>
					<input type="text" name="search" @input="search_input_changed($event)" :value="search_input">
					<span @click="search_products()" v-if="searching_completed">Отмена</span>
					<span @click="search_products()" v-if="!searching_completed">Поиск</span>
				</form>
			</div>

			<div class="table">
				<div class="row column_names">
					<div class="column">
						<div class="column-img">Фото</div>
					</div>
					<div class="column">Названия</div>
					<div class="column">Код товара</div>
					<div class="column">Цена</div>
					<div class="column"></div>
				</div>

				<div class="rows">
					<div class="row" v-for="product in products">
						<div class="column">
							<div class="column-img" :style="'background-image: url(' + product.poster + ')'"></div>
						</div>
						<div class="column">${ product.name }</div>
						<div class="column">${ product.code }</div>
						<div class="column">${ product.price } тг</div>
						<div class="column"><button @click="open_product_form(product)" class="accept_btn">Изменить</button></div>
					</div>
				</div>
			</div>
		</div>

		<div id="product_form_window">
			<form id="product_form" @submit.prevent="product_form_submit()">
				{% csrf_token %}
				<div class="add_product_block">
					<h2 style="margin-top: 0" v-if="product_form.id">Редактировать товар</h2>
					<h2 style="margin-top: 0" v-else>Добавить товар</h2>

					<div class="add_product block_css">
						<b>Категория:</b>
						<input name="product_category" type="text" required v-model="product_form.category" list="categories_list" @change="get_brands(product_form.category)">
						<datalist id="categories_list">
							<option v-for="category in categories" :value="category">
						</datalist>
					</div>
					<div class="add_product block_css">
						<b>Название:</b>
						<input name="product_name" type="text" placeholder="Название" required v-model="product_form['name']">
					</div>
					<div class="add_product block_css">
						<b>Код товара:</b>
						<input name="product_code" type="text" placeholder="Код товара" required v-model="product_form['code']">
					</div>
					<div class="add_product block_css">
						<b>Бренд:</b>
						<input name="product_brand" type="text" required v-model="product_form.brand" list="brands_list">
						<datalist id="brands_list">
							<option v-for="brand in brands" :value="brand">
						</datalist>
					</div>
					<div class="add_product product_imgs_inputs">
						<b>Обложка: </b>
						<div style="margin-bottom: 5px" v-if="!product_poster_is_uploaded_to_input()">
							<a class="uploaded_file_name" style="margin-right: 1px; width: fit-content; cursor: initial">Текущий:</a>
							<a :href="product_form.poster" v-cloak class="uploaded_file_name" v-if="product_form.poster">${ product_form.poster.replace('/media/posters/', '') }</a>
						</div>
						<input name="product_poster" id="poster_file_input" type="file" @change="handle_product_poster_upload($event)" :required="product_form.poster == ''" class="service_form_image_input">
					</div>
					<div class="add_product block_css">
						<b>Цена:</b>
						<input name="product_price" type="number" placeholder="Цена" required v-model="product_form['price']">
					</div>
					<div class="add_product block_css">
						<b>О товаре</b>
						<div id="product_form_description_editor"></div>
					</div>

					<div class="add_product btns">
						<div v-if="product_form.id">
							<button class="add_btn" type="submit">Изменить</button>
							<button class="delete_btn" type="button" @click="delete_product()">Удалить</button>
						</div>
						<div v-else>
							<button class="add_btn" type="submit">Добавить</button>
						</div>
					</div>
				</div>

				<div class="close">
					<a onclick='document.getElementById("product_form_window").style.display = "none"'><img src="{% static 'imgs/shabyt.imgs/cross.png' %}" alt=""></a>
				</div>
			</form>
		</div>
	</div>

	<div class="section" id="requests" style="display: none">
		<div class="section_content">
			<div class="section_top">
				<div class="section_title">
					<h2>Заявки</h2>
				</div>
			</div>

			<ul class="block categories_list vertical_categories_list">
				<li @click="open_category('store')" id="store_requests_category">Магазин<span id="new_requests_count_for_store" class="new_requests_not_found"></span></li>
				<li @click="open_category('services')" id="services_requests_category">Услуги<span id="new_requests_count_for_services" class="new_requests_not_found"></span></li>
			</ul>

			<div class="table">
				<div class="row column_names">
					<div class="column">ФИО</div>
					<div class="column">Номер телефона</div>
					<div class="column">Время</div>
					<div class="column">Принято</div>
					<div class="column" v-if="current_section == 'services'">Услуга</div>
					<div class="column" v-else-if="current_section == 'store'">Заказ</div>
					<div class="column"></div>
				</div>

				<div class="rows">
					<div class="row" v-for="request in requests">
						<div class="column">${ request.fullname }</div>
						<div class="column">${ request.phone_number }</div>
						<div class="column">${ get_valid_at(request.created_at) }</div>
						<div class="column">${ get_valid_at(request.answered_at) }</div>

						<div class="column" v-if="current_category == 'services'" v-html="request.data.text"></div>
						<div class="column" v-else="" v-html="request.data.text"></div>

						<div class="column accepted_text" v-if="request.is_accepted" :style="">Принято</div>
						<div class="column" v-else=""><button @click="accept_request(request)" class="accept_btn">Принять</button></div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div style="display: none; margin-top: 30px; margin-left: 30px;" class="section" id="settings">
		<div v-if="!settings_section_is_opened" class="block menu">
			<p onclick="window.location.hash = '#change_password_window'">Изменить пароль</p>
			<p @click="open_tg_ids_form()">Telegram IDs</p>
			<p @click="open_information_on_site_form()">Информация на сайте</p>
		</div>

		<div class="contacts_block" v-if="tg_ids_form_is_opened">
			<div class="go_back">
				<a @click="tg_ids_form_is_opened = false">Назад</a>
			</div>

			<form @submit.prevent="save_tg_ids()">
				{% csrf_token %}
				<div class="contacts">
					<textarea v-model="tg_ids_form" cols="30" rows="10"></textarea>
				</div>

				<div class="edit_btns">
					<button type="submit" class="accept_btn" style="margin-top: 10px;" :disabled="!tg_ids_form_is_opened">Сохранить</button>
				</div>
			</form>
		</div>

		<div class="contacts_block" v-if="information_on_site_form_is_opened" id="contacts_settings">
			<div class="go_back">
				<a @click="information_on_site_form_is_opened = false">Назад</a>
			</div>

			<form @submit.prevent="save_information_on_site()" class="carousel_s_block">
				{% csrf_token %}

				<div class="contacts">
					<div class="contact">
						<h3 style="margin-bottom: 5px; margin-top: 0;">Адрес</h3>
						<input type="text" v-model="information_on_site_form['address']" placeholder="Адрес">
					</div>
					<div class="contact">
						<h3 style="margin-bottom: 5px;">Instagram</h3>
						<input type="text" v-model="information_on_site_form.contacts['insta']" placeholder="Instagram">
					</div>
					<div class="contact">
						<h3 style="margin-bottom: 5px;">Email</h3>
						<input type="text" v-model="information_on_site_form.contacts['email']" placeholder="Email">
					</div>
					<div class="contact">
						<h3 style="margin-bottom: 5px;">Номер телефона</h3>
						<input type="text" v-model="information_on_site_form.contacts['phone_number']" placeholder="Номер телефона">
					</div>
					<div class="contact">
						<h3 style="margin-bottom: 5px;">Ceil1</h3>
						<input type="text" v-model="information_on_site_form.statistics['ceil1']" placeholder="Ceil1">
					</div>
					<div class="contact">
						<h3 style="margin-bottom: 5px;">Ceil2</h3>
						<input type="text" v-model="information_on_site_form.statistics['ceil2']" placeholder="Ceil2">
					</div>
					<div class="contact">
						<h3 style="margin-bottom: 5px;">Ceil3</h3>
						<input type="text" v-model="information_on_site_form.statistics['ceil3']" placeholder="Ceil3">
					</div>
					<div class="contact">
						<h3 style="margin-bottom: 5px;">Ceil4</h3>
						<input type="text" v-model="information_on_site_form.statistics['ceil4']" placeholder="Ceil4">
					</div>
					<div class="contact">
						<h3 style="margin-bottom: 5px;">Ceil5</h3>
						<input type="text" v-model="information_on_site_form.statistics['ceil5']" placeholder="Ceil5">
					</div>
				</div>

				<div class="edit_btns">
					<button type="submit" class="accept_btn" style="margin-top: 10px;" :disabled="!information_on_site_form_is_opened">Сохранить</button>
				</div>
			</form>
		</div>

	</div>

	<div id="change_password_window">
		<form @submit.prevent="change_password_request()">
			{% csrf_token %}
			<div class="reg_block">
				<b>Изменить пароль</b>

				<div class="reg_inputs">
					<span>Текущий пароль</span>
					<input type="password" v-model="ChangePasswordRequestSchema['old_password']" required name="old_password">
				</div>

				<div class="reg_inputs">
					<span>Новый пароль</span>
					<input type="password" v-model="ChangePasswordRequestSchema['new_password1']" required name="new_password1">
				</div>

				<div class="reg_inputs">
					<span>Подтверждение пароля</span>
					<input type="password" v-model="ChangePasswordRequestSchema['new_password2']" required name="new_password2">
				</div>

				<ul class="reg_text" style="padding-left: 20px; display: block">
					<li v-for="error in change_password_form_errors" style="color: red" v-cloak>${ error }</li>
				</ul>

				<div class="reg_inputs" style="margin-top: 20px">
					<button type="submit" id="change_password_form_submit_btn">Изменить пароль</button>
				</div>

				<div class="close">
					<a href="#"><img src="{% static 'imgs/cross.png' %}" alt=""></a>
				</div>
			</div>
		</form>
	</div>

	<div class="scripts">
		<script src="{% static 'js/shabyt.js/services/product_services.js' %}"></script>
		<script src="{% static 'js/shabyt.js/services/site_settings_services.js' %}"></script>

		<script src="{% static 'js/shabyt.js/pages/admin_page/services_app.js' %}"></script>
		<script src="{% static 'js/shabyt.js/pages/admin_page/products_app.js' %}"></script>
		<script src="{% static 'js/shabyt.js/pages/admin_page/requests_app.js' %}"></script>
		<script src="{% static 'js/shabyt.js/pages/admin_page/settings_app.js' %}"></script>

		<script src="{% static 'js/shabyt.js/pages/admin_page/vertical_menu_app.js' %}"></script>

		<script src="{% static 'js/shabyt.js/auth/index.js' %}"></script>
		<script src="{% static 'js/shabyt.js/auth/vue_apps.js' %}"></script>
		<script src="{% static 'js/shabyt.js/services/user_services.js' %}"></script>
	</div>
</body>
</html>